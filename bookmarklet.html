<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºBookmarklet - Race DB App</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      line-height: 1.6;
      color: #333;
      background-color: #f8f9fa;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #007bff;
      text-align: center;
      margin-bottom: 30px;
      font-size: 28px;
    }
    h2 {
      color: #495057;
      border-bottom: 2px solid #007bff;
      padding-bottom: 8px;
      margin-top: 30px;
    }
    .bookmarklet {
      background-color: #e8f4fd;
      border: 2px solid #007bff;
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
      text-align: center;
    }
    .bookmarklet-link {
      display: inline-block;
      background-color: #007bff;
      color: white;
      padding: 15px 30px;
      text-decoration: none;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      cursor: grab;
      transition: background-color 0.3s;
    }
    .bookmarklet-link:hover {
      background-color: #0056b3;
    }
    .step {
      background-color: #f8f9fa;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin: 15px 0;
      border-radius: 0 8px 8px 0;
    }
    .step h3 {
      margin-top: 0;
      color: #28a745;
    }
    .warning {
      background-color: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: 8px;
      padding: 15px;
      margin: 20px 0;
    }
    .warning h3 {
      color: #856404;
      margin-top: 0;
    }
    .code {
      background-color: #f1f3f4;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      padding: 15px;
      font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
      font-size: 12px;
      overflow-x: auto;
      margin: 15px 0;
    }
    .back-link {
      text-align: center;
      margin-top: 30px;
    }
    .back-link a {
      color: #007bff;
      text-decoration: none;
      font-weight: bold;
    }
    .back-link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”– ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºBookmarklet</h1>
    
    <p>netkeibaã®ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ã‹ã‚‰ç«¶é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’ç°¡å˜ã«æŠ½å‡ºã§ãã‚‹Bookmarkletã§ã™ã€‚<br>
    ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦è¨­ç½®ã—ã¦ãã ã•ã„ã€‚</p>

    <div class="warning">
      <h3>âš ï¸ é‡è¦ãªæ³¨æ„äº‹é …</h3>
      <ul>
        <li><strong>å€‹äººåˆ©ç”¨ãƒ»ç ”ç©¶ç”¨é€”ã«é™å®š</strong>ã—ã¦ãã ã•ã„</li>
        <li><strong>å•†ç”¨åˆ©ç”¨ã¯ç¦æ­¢</strong>ã•ã‚Œã¦ã„ã¾ã™</li>
        <li>éåº¦ãªé€£ç¶šå®Ÿè¡Œã¯é¿ã‘ã€<strong>é©åº¦ãªé–“éš”</strong>ã‚’é–‹ã‘ã¦ä½¿ç”¨ã—ã¦ãã ã•ã„</li>
        <li>netkeibaã®åˆ©ç”¨è¦ç´„ã‚’éµå®ˆã—ã¦ãã ã•ã„</li>
      </ul>
    </div>

    <h2>ğŸ“¥ Bookmarkletè¨­ç½®</h2>
    
    <div class="bookmarklet">
      <p><strong>ä¸‹ã®ãƒªãƒ³ã‚¯ã‚’ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„</strong></p>
      
      <!-- é€šå¸¸ç‰ˆBookmarklet -->
      <a href="javascript:(function(){try{const raceTitle=document.querySelector('.RaceName')?.textContent?.trim()||'';const raceData01=document.querySelector('.RaceData01')?.textContent?.trim()||'';const raceData02=document.querySelector('.RaceData02')?.textContent?.trim()||'';const horses=[];document.querySelectorAll('.Shutuba_Table tbody tr').forEach(row=>{const cells=row.querySelectorAll('td');if(cells.length>=11){const frameNumber=parseInt(cells[0]?.textContent?.trim())||0;const horseNumber=parseInt(cells[1]?.textContent?.trim())||0;const horseName=cells[3]?.querySelector('a')?.textContent?.trim()||cells[3]?.textContent?.trim()||'';const sexAge=cells[4]?.textContent?.trim()||'';const weight=parseFloat(cells[5]?.textContent?.trim())||0;const jockey=cells[6]?.querySelector('a')?.textContent?.trim()||cells[6]?.textContent?.trim()||'';if(horseName){horses.push({frameNumber,horseNumber,name:horseName,sex:sexAge.match(/([ç‰¡ç‰ã‚»])/)?.[1]||'',age:parseInt(sexAge.match(/(\d+)/)?.[1])||0,weight,jockey,odds:0,popularity:0});}}});const data={raceTitle,raceData01,raceData02,horses};navigator.clipboard.writeText(JSON.stringify(data)).then(()=>{alert(`ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã—ãŸï¼\nãƒ¬ãƒ¼ã‚¹: ${raceTitle}\né¦¬æ•°: ${horses.length}é ­\n\nã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ãŸã®ã§ã€ã‚¢ãƒ—ãƒªã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚`);})}catch(error){alert('ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã«å¤±æ•—ã—ã¾ã—ãŸ: '+error.message);}})()" 
           class="bookmarklet-link">
        ğŸ‡ netkeibaãƒ‡ãƒ¼ã‚¿æŠ½å‡ºï¼ˆé€šå¸¸ç‰ˆï¼‰
      </a>
      
      <br><br>
      
      <!-- ãƒ‡ãƒãƒƒã‚°ç‰ˆBookmarklet -->
      <a href="javascript:(function(){console.log('ğŸš€ Bookmarkleté–‹å§‹ï¼');alert('Bookmarkleté–‹å§‹ï¼ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„');try{console.log('ğŸ“„ ãƒšãƒ¼ã‚¸URL:', window.location.href);const raceTitle=document.querySelector('.RaceName')?.textContent?.trim()||'';const raceData01=document.querySelector('.RaceData01')?.textContent?.trim()||'';const raceData02=document.querySelector('.RaceData02')?.textContent?.trim()||'';console.log('ğŸ‡ ãƒ¬ãƒ¼ã‚¹å:', raceTitle);console.log('ğŸ“Š ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿01:', raceData01);console.log('ğŸ“Š ãƒ¬ãƒ¼ã‚¹ãƒ‡ãƒ¼ã‚¿02:', raceData02);const horses=[];const tableRows=document.querySelectorAll('.Shutuba_Table tbody tr');console.log('ğŸ“‹ è¦‹ã¤ã‹ã£ãŸãƒ†ãƒ¼ãƒ–ãƒ«è¡Œæ•°:', tableRows.length);tableRows.forEach((row,index)=>{const cells=row.querySelectorAll('td');console.log(`ğŸ é¦¬${index+1}: ã‚»ãƒ«æ•°=${cells.length}`);if(cells.length>=11){const frameNumber=parseInt(cells[0]?.textContent?.trim())||0;const horseNumber=parseInt(cells[1]?.textContent?.trim())||0;const horseName=cells[3]?.querySelector('a')?.textContent?.trim()||cells[3]?.textContent?.trim()||'';console.log(`  æ ${frameNumber}_é¦¬${horseNumber}: ${horseName}`);if(horseName){horses.push({frameNumber,horseNumber,name:horseName,sex:'',age:0,weight:0,jockey:'',odds:0,popularity:0});}}});console.log('âœ… æŠ½å‡ºå®Œäº†:', horses.length+'é ­');alert(`ãƒ‡ãƒãƒƒã‚°å®Œäº†ï¼\né¦¬æ•°: ${horses.length}é ­\nã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„`);}catch(error){console.error('âŒ ã‚¨ãƒ©ãƒ¼:', error);alert('ã‚¨ãƒ©ãƒ¼: '+error.message);}})()" 
           class="bookmarklet-link" style="background-color: #dc3545;">
        ğŸ” ãƒ‡ãƒãƒƒã‚°ç‰ˆï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰
      </a>
    </div>

    <h2>ğŸ“‹ ä½¿ç”¨æ–¹æ³•</h2>
    
    <div class="step">
      <h3>ã‚¹ãƒ†ãƒƒãƒ— 1: Bookmarkletè¨­ç½®</h3>
      <p>ä¸Šã®ãƒªãƒ³ã‚¯ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã«ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <div class="step">
      <h3>ã‚¹ãƒ†ãƒƒãƒ— 2: netkeibaãƒšãƒ¼ã‚¸ã‚’é–‹ã</h3>
      <p>netkeibaã®ãƒ¬ãƒ¼ã‚¹ãƒšãƒ¼ã‚¸ï¼ˆå‡ºé¦¬è¡¨ãƒšãƒ¼ã‚¸ï¼‰ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚<br>
      ä¾‹: <code>https://race.netkeiba.com/race/shutuba.html?race_id=...</code></p>
    </div>

    <div class="step">
      <h3>ã‚¹ãƒ†ãƒƒãƒ— 3: Bookmarkletå®Ÿè¡Œ</h3>
      <p>ãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯ãƒãƒ¼ã®ã€ŒğŸ‡ netkeibaãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã€ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚<br>
      ãƒ‡ãƒ¼ã‚¿ãŒæŠ½å‡ºã•ã‚Œã€ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã™ã€‚</p>
    </div>

    <div class="step">
      <h3>ã‚¹ãƒ†ãƒƒãƒ— 4: ã‚¢ãƒ—ãƒªã§è²¼ã‚Šä»˜ã‘</h3>
      <p>Race DB Appã®ã€ŒBookmarklet ãƒ‡ãƒ¼ã‚¿å…¥åŠ›ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«JSONãƒ‡ãƒ¼ã‚¿ã‚’è²¼ã‚Šä»˜ã‘ã¦ã€<br>
      ã€ŒğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãã ã•ã„ã€‚</p>
    </div>

    <h2>ğŸ”§ æŠ€è¡“è©³ç´°</h2>
    
    <p>Bookmarkletã¯ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã™ï¼š</p>
    <ul>
      <li><strong>ãƒ¬ãƒ¼ã‚¹æƒ…å ±</strong>: ãƒ¬ãƒ¼ã‚¹åã€è·é›¢ã€é¦¬å ´ã€ã‚³ãƒ¼ã‚¹</li>
      <li><strong>é¦¬ãƒ‡ãƒ¼ã‚¿</strong>: æ ç•ªã€é¦¬ç•ªã€é¦¬åã€æ€§åˆ¥ã€å¹´é½¢ã€æ–¤é‡ã€é¨æ‰‹</li>
    </ul>

    <details>
      <summary><strong>Bookmarkletã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆå‚è€ƒï¼‰</strong></summary>
      <div class="code">
javascript:(function(){
  try {
    // ãƒ¬ãƒ¼ã‚¹åŸºæœ¬æƒ…å ±ã‚’æŠ½å‡º
    const raceTitle = document.querySelector('.RaceName')?.textContent?.trim() || '';
    const raceData01 = document.querySelector('.RaceData01')?.textContent?.trim() || '';
    const raceData02 = document.querySelector('.RaceData02')?.textContent?.trim() || '';
    
    // é¦¬ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡º
    const horses = [];
    document.querySelectorAll('.Shutuba_Table tbody tr').forEach(row => {
      const cells = row.querySelectorAll('td');
      if (cells.length >= 11) {
        const frameNumber = parseInt(cells[0]?.textContent?.trim()) || 0;
        const horseNumber = parseInt(cells[1]?.textContent?.trim()) || 0;
        const horseName = cells[3]?.querySelector('a')?.textContent?.trim() || 
                         cells[3]?.textContent?.trim() || '';
        const sexAge = cells[4]?.textContent?.trim() || '';
        const weight = parseFloat(cells[5]?.textContent?.trim()) || 0;
        const jockey = cells[6]?.querySelector('a')?.textContent?.trim() || 
                      cells[6]?.textContent?.trim() || '';
        
        // ã‚ªãƒƒã‚ºã¨äººæ°—ã‚’å–å¾—ï¼ˆIDãƒ™ãƒ¼ã‚¹ã§æ¤œç´¢ï¼‰
        let oddsText = cells[9]?.textContent?.trim() || '';
        let popularityText = cells[10]?.textContent?.trim() || '';
        
        // ID ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ã‚ªãƒƒã‚ºã¨äººæ°—ã‚’æ¢ã™è©¦è¡Œ
        const frameStr = String(frameNumber);
        const horseStr = String(horseNumber).toString().padStart(2, '0');
        
        // odds-{æ }_{é¦¬ç•ª} ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã‚ªãƒƒã‚ºã‚’æ¤œç´¢
        const oddsId = `odds-${frameStr}_${horseStr}`;
        const popularityId = `ninki-${frameStr}_${horseStr}`;
        
        console.log(`ğŸ” Bookmarklet Debug: æ ${frameNumber}_é¦¬${horseNumber} æ¤œç´¢ä¸­...`);
        console.log(`ğŸ†” æ¤œç´¢ID: ã‚ªãƒƒã‚º="${oddsId}", äººæ°—="${popularityId}"`);
        
        const oddsElement = document.getElementById(oddsId);
        const popularityElement = document.getElementById(popularityId);
        
        console.log(`ğŸ” è¦ç´ ç™ºè¦‹: ã‚ªãƒƒã‚º=${oddsElement ? 'ã‚ã‚Š' : 'ãªã—'}, äººæ°—=${popularityElement ? 'ã‚ã‚Š' : 'ãªã—'}`);
        
        if (oddsElement) {
          const dynamicOdds = oddsElement.textContent.trim();
          console.log(`ğŸ’° ã‚ªãƒƒã‚ºè¦ç´ å†…å®¹: "${dynamicOdds}"`);
          if (dynamicOdds && dynamicOdds !== '---.-' && dynamicOdds !== '**') {
            oddsText = dynamicOdds;
            console.log(`âœ… ã‚ªãƒƒã‚ºå–å¾—æˆåŠŸ: ${dynamicOdds}`);
          }
        } else {
          console.log(`âŒ ã‚ªãƒƒã‚ºè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${oddsId}`);
        }
        
        if (popularityElement) {
          const dynamicPopularity = popularityElement.textContent.trim();
          console.log(`ğŸ† äººæ°—è¦ç´ å†…å®¹: "${dynamicPopularity}"`);
          if (dynamicPopularity && dynamicPopularity !== '**' && dynamicPopularity !== '--') {
            popularityText = dynamicPopularity;
            console.log(`âœ… äººæ°—å–å¾—æˆåŠŸ: ${dynamicPopularity}`);
          }
        } else {
          console.log(`âŒ äººæ°—è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${popularityId}`);
        }
        
        // ä»–ã®å¯èƒ½æ€§ã®ã‚ã‚‹ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ã‚‚è©¦è¡Œï¼ˆæœ€åˆã®é¦¬ã®ã¿ï¼‰
        if ((!oddsElement || oddsText === '---.-') && horseNumber === 1) {
          console.log('ğŸ” ä»–ã®ã‚ªãƒƒã‚ºè¦ç´ ã‚’æ¢ç´¢ä¸­...');
          const allOddsElements = document.querySelectorAll('[id*="odds"]');
          console.log(`ğŸ¯ è¦‹ã¤ã‹ã£ãŸã‚ªãƒƒã‚ºé–¢é€£è¦ç´ : ${allOddsElements.length}å€‹`);
          allOddsElements.forEach((el, idx) => {
            console.log(`  [${idx}] ID: ${el.id}, å†…å®¹: "${el.textContent.trim()}"`);
          });
        }
        
        // ã‚ªãƒƒã‚ºã¨äººæ°—ã®å€¤ã‚’ãƒ‘ãƒ¼ã‚¹ï¼ˆãƒ¬ãƒ¼ã‚¹å‰ã¯0ã«ã™ã‚‹ï¼‰
        let odds = 0;
        let popularity = 0;
        
        if (oddsText && oddsText !== '---.-' && oddsText !== '**' && oddsText !== '--') {
          odds = parseFloat(oddsText) || 0;
        }
        
        if (popularityText && popularityText !== '**' && popularityText !== '--' && popularityText !== '') {
          popularity = parseInt(popularityText) || 0;
        }
        
        if (horseName) {
          horses.push({
            frameNumber, horseNumber, name: horseName,
            sex: sexAge.match(/([ç‰¡ç‰ã‚»])/)?.[1] || '',
            age: parseInt(sexAge.match(/(\d+)/)?.[1]) || 0,
            weight, jockey, odds, popularity
          });
        }
      }
    });
    
    // ãƒ‡ãƒ¼ã‚¿ã‚’JSONã«å¤‰æ›ã—ã¦ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
    const data = { raceTitle, raceData01, raceData02, horses };
    navigator.clipboard.writeText(JSON.stringify(data)).then(() => {
      alert(`ãƒ‡ãƒ¼ã‚¿ã‚’æŠ½å‡ºã—ã¾ã—ãŸï¼\nãƒ¬ãƒ¼ã‚¹: ${raceTitle}\né¦¬æ•°: ${horses.length}é ­\n\nã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã—ãŸã®ã§ã€ã‚¢ãƒ—ãƒªã§è²¼ã‚Šä»˜ã‘ã¦ãã ã•ã„ã€‚`);
    });
    
  } catch (error) {
    alert('ãƒ‡ãƒ¼ã‚¿æŠ½å‡ºã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
  }
})();
      </div>
    </details>

    <h2>ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
    
    <h3>ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããªã„å ´åˆ</h3>
    <ul>
      <li>netkeibaã®å‡ºé¦¬è¡¨ãƒšãƒ¼ã‚¸ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
      <li>ãƒšãƒ¼ã‚¸ãŒå®Œå…¨ã«èª­ã¿è¾¼ã¾ã‚Œã¦ã‹ã‚‰å®Ÿè¡Œã—ã¦ãã ã•ã„</li>
      <li>ãƒ–ãƒ©ã‚¦ã‚¶ã®JavaScriptãŒæœ‰åŠ¹ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
    </ul>

    <h3>ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼ã•ã‚Œãªã„å ´åˆ</h3>
    <ul>
      <li>ãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¨±å¯ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
      <li>HTTPSæ¥ç¶šã§å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„</li>
    </ul>

    <div class="back-link">
      <a href="/race-db-app/">â† Race DB Appã«æˆ»ã‚‹</a>
    </div>
  </div>
</body>
</html>